# Default values for pv-safe
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Webhook configuration
webhook:
  # Number of webhook replicas
  replicaCount: 2

  image:
    repository: ghcr.io/automationpi/pv-safe
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion
    tag: ""

  imagePullSecrets: []

  # Webhook server port
  port: 8443

  # Resource requests and limits
  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 100m
      memory: 64Mi

  # Node selector for pod assignment
  nodeSelector: {}

  # Tolerations for pod assignment
  tolerations: []

  # Affinity for pod assignment
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - pv-safe-webhook
            topologyKey: kubernetes.io/hostname

  # Security context for the webhook pod
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 65532
    fsGroup: 65532
    seccompProfile:
      type: RuntimeDefault

  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  # Liveness and readiness probes
  livenessProbe:
    httpGet:
      path: /healthz
      port: 8443
      scheme: HTTPS
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /readyz
      port: 8443
      scheme: HTTPS
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Service account configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# RBAC configuration
rbac:
  # Specifies whether RBAC resources should be created
  create: true

# Certificate configuration
certificate:
  # Use cert-manager for certificate management
  # If false, you must provide your own certificate via secret
  enabled: true

  # Certificate issuer
  issuer:
    # Create a self-signed issuer
    create: true
    # Issuer kind: Issuer or ClusterIssuer
    kind: Issuer
    # Issuer name (if not creating one)
    name: ""

  # Certificate duration
  duration: 8760h # 1 year
  renewBefore: 720h # 30 days

  # DNS names for the certificate
  dnsNames:
    - pv-safe-webhook.pv-safe-system.svc
    - pv-safe-webhook.pv-safe-system.svc.cluster.local

# ValidatingWebhookConfiguration settings
validatingWebhook:
  # Failure policy: Fail or Ignore
  # Fail: Block deletions if webhook is unavailable (safer)
  # Ignore: Allow deletions if webhook is unavailable
  failurePolicy: Fail

  # Timeout for webhook requests (in seconds)
  timeoutSeconds: 10

  # Namespace selector to exclude certain namespaces
  namespaceSelector:
    matchExpressions:
      - key: name
        operator: NotIn
        values:
          - kube-system
          - kube-public
          - kube-node-lease
          - pv-safe-system

  # Additional namespace exclusions
  additionalExcludedNamespaces: []

# Namespace configuration
namespace:
  # Create the namespace
  create: true
  # Namespace name
  name: pv-safe-system
  # Namespace labels
  labels: {}
  # Namespace annotations
  annotations: {}

# Metrics configuration (for future Prometheus integration)
metrics:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s

# Additional labels to add to all resources
commonLabels: {}

# Additional annotations to add to all resources
commonAnnotations: {}
